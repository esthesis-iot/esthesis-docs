<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="soft" data-primary-color="#059999" data-link-color="#059999"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2024-10-15T07:07:25.141915051"><title>Dev environment setup | esthesis CORE - Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"requirements","level":0,"title":"Requirements","anchor":"#requirements"},{"id":"kubernetes-initialisation","level":0,"title":"Kubernetes initialisation","anchor":"#kubernetes-initialisation"},{"id":"installation","level":0,"title":"Installation","anchor":"#installation"},{"id":"access-to-resources","level":0,"title":"Access to resources","anchor":"#access-to-resources"},{"id":"running-the-services","level":0,"title":"Running the services","anchor":"#running-the-services"},{"id":"committing-code","level":0,"title":"Committing code","anchor":"#committing-code"},{"id":"notes","level":0,"title":"Notes","anchor":"#notes"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="16x16" href="images/logo.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Dev environment setup | esthesis CORE - Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="esthesis CORE - Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/dev-environment-setup.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Dev environment setup | esthesis CORE - Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/dev-environment-setup.html#webpage",
    "url": "writerside-documentation/dev-environment-setup.html",
    "name": "Dev environment setup | esthesis CORE - Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "esthesis CORE - Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="dev-environment-setup" data-main-title="Dev environment setup" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Developers Guide"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>esthesis CORE - Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="dev-environment-setup" id="dev-environment-setup.md">Dev environment setup</h1><p id="-il22y0_3">In the following sections you can see how to set up a development environment for esthesis CORE. The development environment varies drastically from the production setup, as its purpose is to allow developers to quickly implement and test new features.</p><p id="-il22y0_4">Setting up your development environment is relatively easy, as you can use the production environment Helm charts; with a tweak. The major difference between using Helm to deploy on production and creating a development environment in your machine is that all esthesis services should run locally on your machine, instead of being deployed to the Kubernetes cluster.</p><section class="chapter"><h2 id="requirements" data-toc="requirements">Requirements</h2><ul class="list _bullet" id="-il22y0_12"><li class="list__item" id="-il22y0_13"><p>A dev Kubernetes cluster with at least 16GB of RAM.</p></li><li class="list__item" id="-il22y0_14"><p><a href="https://helm.sh" id="-il22y0_19" data-external="true" rel="noopener noreferrer">Helm</a></p></li><li class="list__item" id="-il22y0_15"><p><a href="https://github.com/helmfile/helmfile" id="-il22y0_20" data-external="true" rel="noopener noreferrer">Helmfile</a></p></li><li class="list__item" id="-il22y0_16"><p>Many of the build and helper scripts are written for a Unix/Linux shell. If you are on Windows, you can use <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10" id="-il22y0_21" data-external="true" rel="noopener noreferrer">WSL</a> or <a href="https://www.cygwin.com/" id="-il22y0_22" data-external="true" rel="noopener noreferrer">Cygwin</a>.</p></li><li class="list__item" id="-il22y0_17"><p><a href="https://github.com/grafana/loki/releases" id="-il22y0_23" data-external="true" rel="noopener noreferrer">Promtail</a>. Promtail is used to provide a local UDP GELF endpoint to collect logs and forward them to Loki. If you want to develop and test Loki functionality you need to be running Promtail with the configuration file in <code class="code" id="-il22y0_24">_dev/promtail/config.yaml</code>, e.g. <code class="code" id="-il22y0_25">promtail --config.file=config.yaml</code>.</p></li><li class="list__item" id="-il22y0_18"><p><a href="https://github.com/ahmetb/kubectx" id="-il22y0_26" data-external="true" rel="noopener noreferrer">Kubens + Kubectx</a> for easy context and namespace switching.</p></li></ul></section><section class="chapter"><h2 id="kubernetes-initialisation" data-toc="kubernetes-initialisation">Kubernetes initialisation</h2></section><section class="chapter"><h2 id="installation" data-toc="installation">Installation</h2><p id="-il22y0_27">Unless you are on a cluster shared with others, create and use a namespace named &quot;esthesis&quot;, so that you can follow the instructions below without having to change parameters. If you are using a different namespace, replace it accordingly.</p><ul class="list _bullet" id="-il22y0_28"><li class="list__item" id="-il22y0_29"><p id="-il22y0_31">Install the supporting dependencies in <code class="code" id="-il22y0_36">esthesis-helm/esthesis-core-deps</code>:</p><div class="code-block" data-lang="bash">
	helmfile -e dev sync --namespace=esthesis
</div><aside class="prompt" data-type="tip" data-title="" id="-il22y0_33"><p>Once you have performed the initial installation, you can use the `--skip-deps` flag to skip the dependencies check, therefore speeding up your re-deployment.</p></aside><p id="-il22y0_34">Several supporting services are disabled by default. You can enable the following services by setting their respective environment values to <code class="code" id="-il22y0_37">true</code> before running <code class="code" id="-il22y0_38">helmfile</code>:</p><div class="table-wrapper"><table class="wide" id="-il22y0_35"><thead><tr class="ijRowHead" id="-il22y0_39"><th id="-il22y0_46"><p>Service</p></th><th id="-il22y0_47"><p>Environment variable</p></th></tr></thead><tbody><tr id="-il22y0_40"><td id="-il22y0_48"><p>Grafana</p></td><td id="-il22y0_49"><p>GRAFANA_ENABLED</p></td></tr><tr id="-il22y0_41"><td id="-il22y0_50"><p>Grafana Loki</p></td><td id="-il22y0_51"><p>GRAFANA_LOKI_ENABLED</p></td></tr><tr id="-il22y0_42"><td id="-il22y0_52"><p>Grafana Tempo</p></td><td id="-il22y0_53"><p>GRAFANA_TEMPO_ENABLED</p></td></tr><tr id="-il22y0_43"><td id="-il22y0_54"><p>Container Registry</p></td><td id="-il22y0_55"><p>REGISTRY_ENABLED</p></td></tr><tr id="-il22y0_44"><td id="-il22y0_56"><p>Kafka UI</p></td><td id="-il22y0_57"><p>KAFKA_UI_ENABLED</p></td></tr><tr id="-il22y0_45"><td id="-il22y0_58"><p>Orion LD</p></td><td id="-il22y0_59"><p>ORION_LD_ENABLED</p></td></tr></tbody></table></div></li><li class="list__item" id="-il22y0_30"><p id="-il22y0_60">Install the application components in <code class="code" id="-il22y0_62">esthesis-helm/esthesis-core</code>:</p><div class="code-block" data-lang="bash">
	helmfile -e dev sync --namespace=esthesis
</div></li></ul></section><section class="chapter"><h2 id="access-to-resources" data-toc="access-to-resources">Access to resources</h2><p id="-il22y0_63">To proxy the Kubernetes services of the project to your local machine for development purposes, you can use <a href="https://kubefwd.com" id="-il22y0_67" data-external="true" rel="noopener noreferrer">kubefwd</a> and execute:</p><div class="code-block" data-lang="bash">
sudo -E kubefwd svc -d esthesis
</div><ol class="list _decimal" id="-il22y0_65" type="1"><li class="list__item" id="-il22y0_68"><p>kubefwd will proxy all services to your localhost and create local DNS entries for them. The table below summarises the resources you can access after running the above command. Replace <code class="code" id="-il22y0_71">&lt;namespace&gt;</code> with the namespace you have deployed the services to. Note that if you have deployed the services in a different namespace than <code class="code" id="-il22y0_72">esthesis</code>, you need to adjust the namespace element in the domains in the table below:</p></li><li class="list__item" id="-il22y0_69"><p>You may need to, occasionally, restart kubefwd, especially if pods get recreated often or if your development machine went through sleep mode.</p></li><li class="list__item" id="-il22y0_70"><p>The Container Registry is deployed as a NodePort service with a randomly assigned port. If you need to specify your own port, you can use the <code class="code" id="-il22y0_73">REGISTRY_NODE_PORT</code> environment variable when deploying the Helm Chart.</p></li></ol><div class="table-wrapper"><table class="wide" id="-il22y0_66"><thead><tr class="ijRowHead" id="-il22y0_74"><th id="-il22y0_87"><p>Resource</p></th><th id="-il22y0_88"><p>URL/host</p></th><th id="-il22y0_89"><p>Credentials</p></th></tr></thead><tbody><tr id="-il22y0_75"><td id="-il22y0_90"><p>Redis</p></td><td id="-il22y0_91"><p>redis-master.esthesis:6379/0</p></td><td id="-il22y0_92"><p>(empty) / esthesis-system</p></td></tr><tr id="-il22y0_76"><td id="-il22y0_93"><p>Mosquitto</p></td><td id="-il22y0_94" colspan="2"><p>mosquitto.esthesis:1883</p></td></tr><tr id="-il22y0_77"><td id="-il22y0_95"><p>Grafana</p></td><td id="-il22y0_96"><p>http://grafana.esthesis:3000</p></td><td id="-il22y0_97"><p>esthesis-system / esthesis-system</p></td></tr><tr id="-il22y0_78"><td id="-il22y0_98"><p>InfluxDB Admin UI</p></td><td id="-il22y0_99"><p>http://influxdb.esthesis:8086</p></td><td id="-il22y0_100"><p>esthesis-system / esthesis-system</p></td></tr><tr id="-il22y0_79"><td id="-il22y0_101"><p>InfluxDB</p></td><td id="-il22y0_102" colspan="2"><p>influxdb.esthesis:8088</p></td></tr><tr id="-il22y0_80"><td id="-il22y0_103"><p>MongoDB</p></td><td id="-il22y0_104"><p>mongodb-headless.esthesis:27017</p></td><td id="-il22y0_105"><p>esthesis-system / esthesis-system</p></td></tr><tr id="-il22y0_81"><td id="-il22y0_106"><p>esthesis CORE UI</p></td><td id="-il22y0_107"><p>http://localhost:4200</p></td><td id="-il22y0_108"><p>esthesis-admin / esthesis-admin</p></td></tr><tr id="-il22y0_82"><td id="-il22y0_109"><p>Keycloak</p></td><td id="-il22y0_110"><p>http://keycloak.esthesis</p></td><td id="-il22y0_111"><p>esthesis-system / esthesis-system</p></td></tr><tr id="-il22y0_83"><td id="-il22y0_112"><p>Kafka</p></td><td id="-il22y0_113" colspan="2"><p>kafka.esthesis:9095</p></td></tr><tr id="-il22y0_84"><td id="-il22y0_114"><p>Kafka UI</p></td><td id="-il22y0_115" colspan="2"><p>http://kafka-ui.esthesis</p></td></tr><tr id="-il22y0_85"><td id="-il22y0_116"><p>Docker Registry UI</p></td><td id="-il22y0_117" colspan="2"><p>http://docker-registry-user-interface.esthesis/</p></td></tr><tr id="-il22y0_86"><td id="-il22y0_118"><p>Orion LD</p></td><td id="-il22y0_119" colspan="2"><p>http://orionld.esthesis:1026</p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="running-the-services" data-toc="running-the-services">Running the services</h2><p id="-il22y0_120">The above installation will prepare all the necessary components to support esthesis CORE. The actual backend services as well as the UI, however, will not be installed in Kubernetes. You need to run these in your local machine. Note that we did try Quarkus' remote development mode, but it was a bit finicky, and we ended up losing time when it was not working or not picking up changes correctly.</p><section class="chapter"><h3 id="frontend" data-toc="frontend">Frontend</h3><p id="-il22y0_124">You can start the Angular frontend by running <code class="code" id="-il22y0_125">npm start</code> in <code class="code" id="-il22y0_126">esthesis-core-ui</code> directory.</p></section><section class="chapter"><h3 id="backend" data-toc="backend">Backend</h3><p id="-il22y0_127">Each backend service comes with its own <code class="code" id="-il22y0_129">dev-{service-name}.sh</code> script that you can use to start the service in development mode. You need to run each of the services in a separate terminal window.</p><p id="-il22y0_128">Many of the backend services need to access the dependency services (e.g. Keycloak, Kafka, MongoDB, etc.) you have deployed above. To be able to figure out the domain name under which these services are accessible, we are using internally <code class="code" id="-il22y0_130">kubens -c</code>, so make sure before you start up a service you have switched to the Kubernetes context and namespace where the services are deployed.</p></section><section class="chapter"><h3 id="automation" data-toc="automation">Automation</h3><p id="-il22y0_131">Starting up (and restarting) all those services manually can be a tedious task. We have prepared a <a href="https://github.com/tmux/tmux/wiki" id="-il22y0_134" data-external="true" rel="noopener noreferrer">tmux</a> script that you can use to start all services in a single terminal window in multiple panes, while merging all log output into another pane. You can find the script in <code class="code" id="-il22y0_135">_dev/tmux-dev.sh</code>. We also provide a <code class="code" id="-il22y0_136">.tmux.conf</code> file, in case you want to replicate our own tmux look and feel.</p><figure data-theme="light" id="-il22y0_132" width="640"><img alt="tmux.gif" class="js-gif article__bordered-element" data-gif-src="images/tmux.gif" width="640" style="width: 640px;"></figure><aside class="prompt" data-type="tip" data-title="" id="-il22y0_133"><p>You can quickly terminate all services by issuing `tmux kill-session -t esthesis-dev`.</p></aside></section></section><section class="chapter"><h2 id="committing-code" data-toc="committing-code">Committing code</h2><p id="-il22y0_137">We are using <a href="https://www.conventionalcommits.org/en/v1.0.0/" id="-il22y0_138" data-external="true" rel="noopener noreferrer">Conventional Commits</a>. There are plugins for all major IDEs, so you can easily follow the convention.</p></section><section class="chapter"><h2 id="notes" data-toc="notes">Notes</h2><ol class="list _decimal" id="-il22y0_139" type="1"><li class="list__item" id="-il22y0_140"><p id="-il22y0_145">Before trying to log in to the application open the (https) Keycloak URL into your browser in order to accept the self-signed certificate. Otherwise, the first redirect from the application's UI to Keycloak will fail.</p></li><li class="list__item" id="-il22y0_141"><p id="-il22y0_146">There is a convenience script <code class="code" id="-il22y0_147">destroy.sh</code> in the root of each helm package. You can use it to fully erase all installations performed for that particular package together with any additional Kubernetes resources that do not get automatically deleted by uninstalling the Helm chart (for example, PVCs).</p></li><li class="list__item" id="-il22y0_142"><p id="-il22y0_148">Installing all components for development under a single Kubernetes node may require you to increase certain OS limits, here are the ones we have found to be relevant in Ubuntu server 23.04:</p><div class="code-block" data-lang="bash">
	 sudo sysctl fs.inotify.max_user_instances=1280
	 sudo sysctl fs.inotify.max_user_watches=655360
</div><p id="-il22y0_150">If you face any issues building the project via Maven, you may also need to increase the number of open files:</p><div class="code-block" data-lang="none">
	 ulimit -S -n 65536
</div></li><li class="list__item" id="-il22y0_143"><p id="-il22y0_152">You can create a <code class="code" id="-il22y0_153">local-env.sh</code> script alongside the <code class="code" id="-il22y0_154">dev-{service}.sh</code> scripts to customise your local development environment. If such a file exist, it will be sourced by the <code class="code" id="-il22y0_155">dev-{service}.sh</code>.</p></li><li class="list__item" id="-il22y0_144"><p id="-il22y0_156"><code class="code" id="-il22y0_157">srv-kubernetes</code> service needs to be able to create new pods in your Kubernetes environment. This requires a valid <code class="code" id="-il22y0_158">~/.kube/config</code> file in your home directory. In case you are splitting your Kubernetes config into multiple files, you can use the <code class="code" id="-il22y0_159">KUBECONFIG</code> environment variable to point to the config file you want to use. You can specify this variable in your <code class="code" id="-il22y0_160">local-env.sh</code> file as explained above.</p></li></ol></section><div class="last-modified">Last modified: 15 October 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="fiware-orion-gateway.html" class="navigation-links__prev">Fiware Orion gateway dataflow</a><a href="working-with-helm-charts.html" class="navigation-links__next">Working with Helm charts</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.js"></script></body></html>