<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="soft" data-primary-color="#059999" data-link-color="#059999"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2024-10-15T09:16:16.685180337"><title>Resources vs System Resources | esthesis CORE - Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"service-module-structure","level":0,"title":"Service module structure","anchor":"#service-module-structure"},{"id":"security","level":0,"title":"Security","anchor":"#security"},{"id":"resource","level":0,"title":"Resource","anchor":"#resource"},{"id":"system-resource","level":0,"title":"System Resource","anchor":"#system-resource"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="16x16" href="images/logo.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Resources vs System Resources | esthesis CORE - Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="esthesis CORE - Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/resources-vs-system-resources.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Resources vs System Resources | esthesis CORE - Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/resources-vs-system-resources.html#webpage",
    "url": "writerside-documentation/resources-vs-system-resources.html",
    "name": "Resources vs System Resources | esthesis CORE - Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "esthesis CORE - Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="resources-vs-system-resources" data-main-title="Resources vs System Resources" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Developers Guide"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>esthesis CORE - Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="resources-vs-system-resources" id="resources-vs-system-resources.md">Resources vs System Resources</h1><p id="-ei8q3k_3">This page explains the concept of Resources and System Resources in esthesis.</p><section class="chapter"><h2 id="service-module-structure" data-toc="service-module-structure">Service module structure</h2><p id="-ei8q3k_8">Before we delve into the details, we should first have a basic understanding of the structure of an esthesis service:</p><ul class="list _bullet" id="-ei8q3k_9"><li class="list__item" id="-ei8q3k_11"><p>Client module: The client module defines the client interface of the service. It is the only module that is exposed to the outside world, and it is the only module that can be imported by other services.</p></li><li class="list__item" id="-ei8q3k_12"><p>Impl module: The impl module provides the implementation of the client module. This module should never be imported by other services.</p></li></ul><p id="-ei8q3k_10">The client module of each service is kind of &quot;special&quot;, as it is annotated with Quarkus' <code class="code" id="-ei8q3k_13">@RegisterRestClient</code> annotation. This annotation tells Quarkus to generate a REST client for the service which can then be injected into other services. This way we get a &quot;free&quot; client for each service that does not need any additional maintenance as the service evolves.</p></section><section class="chapter"><h2 id="security" data-toc="security">Security</h2><p id="-ei8q3k_14">esthesis' security is based on OIDC. An end-user trying to access an esthesis service needs to provide a valid access token. This token is then validated by the service against the OIDC provider. The same applies to service-to-service communication: The source service needs to provide a valid access token to the target service. This token is then validated by the target service against the OIDC provider.</p><p id="-ei8q3k_15">But what happens when a service needs to access another service without having an end-user initiating the request thus providing an access token? This is where the concept of System Resources comes into play.</p><p id="-ei8q3k_16">Effectively, the differentiation of Resources and System Resources is only relevant to the underlying security mechanism: Resources are services requiring an active end-user (i.e. a valid access token provided by the user), whereas System Resources are services that do not require an active end-user. At this point you may be wondering: &quot;...and who provides the access token for System Resources?&quot;. The following sections provide an overview of how Resources and System Resources are defined and used in esthesis.</p></section><section class="chapter"><h2 id="resource" data-toc="resource">Resource</h2><section class="chapter"><h3 id="resource-source-service" data-toc="resource-source-service">Resource Source service</h3><p id="-ei8q3k_19">As the source service does not know the location of the target service merely by importing the target service's REST client, you need to define the target service's location in the source service's <code class="code" id="-ei8q3k_22">application.properties</code> file. Here is an example of how this can be done:</p><div class="code-block" data-lang="none">
rest-client:
	SettingsResource:
		url: http://esthesis-core-srv-settings-service:8080
		scope: Singleton
</div><p id="-ei8q3k_21">The above snippet defines the URL of the <code class="code" id="-ei8q3k_23">SettingsResource</code> service. You can then inject the <code class="code" id="-ei8q3k_24">SettingsResource</code> REST client into your source service and use it to communicate with the Settings service.</p></section><section class="chapter"><h3 id="resource-target-service" data-toc="resource-target-service">Resource Target service</h3><ul class="list _bullet" id="-ei8q3k_25"><li class="list__item" id="-ei8q3k_26"><p>Annotate the <code class="code" id="-ei8q3k_28">SettingsResource</code> interface with <code class="code" id="-ei8q3k_29">@RegisterRestClient(configKey = &quot;SettingsResource&quot;)</code>. It is important to note that the value of the <code class="code" id="-ei8q3k_30">configKey</code> parameter must match the name of the service in source service's <code class="code" id="-ei8q3k_31">application.properties</code> file.</p></li><li class="list__item" id="-ei8q3k_27"><p>Annotate the <code class="code" id="-ei8q3k_32">SettingsResource</code> interface with <code class="code" id="-ei8q3k_33">@RegisterProvider(AccessTokenRequestReactiveFilter.class)</code>. This annotation tells Quarkus to inject the <code class="code" id="-ei8q3k_34">AccessTokenRequestReactiveFilter</code> into the REST client, which is responsible for propagating the access token provided by the end-user calling the source service.</p></li></ul></section></section><section class="chapter"><h2 id="system-resource" data-toc="system-resource">System Resource</h2><section class="chapter"><h3 id="system-resource-source-service" data-toc="system-resource-source-service">System Resource Source service</h3><p id="-ei8q3k_37">Similarly to Resources, you need to define the target service's location in the source service's <code class="code" id="-ei8q3k_44">application.properties</code> file. Here is an example of how this can be done:</p><div class="code-block" data-lang="none">
rest-client:
	SettingsSystemResource:
		url: http://esthesis-core-srv-settings-service:8080
		scope: Singleton
</div><p id="-ei8q3k_39">The above snippet defines the URL of the <code class="code" id="-ei8q3k_45">SettingsSystemResource</code> service. You can then inject the <code class="code" id="-ei8q3k_46">SettingsSystemResource</code> REST client into your source service and use it to communicate with the Settings service.</p><p id="-ei8q3k_40">In this case, the source service will act as an OIDC client, therefore it needs to be configured appropriately to obtain an access token from the OIDC provider. This is done by adding the following properties to the source service's <code class="code" id="-ei8q3k_47">application.properties</code> file:</p><div class="code-block" data-lang="none">
oidc-client:
	client-id: esthesis
	grant:
		type: password
	grant-options:
		password:
			username: ${OIDC_CLIENT_USERNAME}
			password: ${OIDC_CLIENT_PASSWORD}
</div><p id="-ei8q3k_42"><code class="code" id="-ei8q3k_48">${OIDC_CLIENT_USERNAME}</code> and <code class="code" id="-ei8q3k_49">${OIDC_CLIENT_USERNAME}</code> are environment variables allowing the OIDC client to authenticate against the OIDC provider using a password grant. For development, you can set those values to the default values used in esthesis' default Keycloak esthesis-realm <code class="code" id="-ei8q3k_50">esthesis-system</code>. In production, those values will be provided by the Kubernetes deployment descriptor resulting from the esthesis Helm charts. To instruct Helm to inject those values into a deployment, you need to set the following flags to the <code class="code" id="-ei8q3k_51">deployment.yaml</code> descriptor of the source service:</p><div class="code-block" data-lang="yaml">
&quot;podOidcClient&quot; true
</div></section><section class="chapter"><h3 id="system-resource-target-service" data-toc="system-resource-target-service">System Resource Target service</h3><ul class="list _bullet" id="-ei8q3k_52"><li class="list__item" id="-ei8q3k_53"><p>Annotate the <code class="code" id="-ei8q3k_55">SettingsSystemResource</code> interface with <code class="code" id="-ei8q3k_56">@RegisterRestClient(configKey = &quot;SettingsSystemResource&quot;)</code>. It is important to note that the value of the <code class="code" id="-ei8q3k_57">configKey</code> parameter must match the name of the service in source service's <code class="code" id="-ei8q3k_58">application.properties</code> file.</p></li><li class="list__item" id="-ei8q3k_54"><p>Annotate the <code class="code" id="-ei8q3k_59">SettingsSystemResource</code> interface with <code class="code" id="-ei8q3k_60">@RegisterProvider(OidcClientRequestReactiveFilter.class)</code>. This annotation tells Quarkus to inject the <code class="code" id="-ei8q3k_61">OidcClientRequestReactiveFilter</code> into the REST client, which is responsible to obtain (e.g. create) a valid access token from the OIDC provider and propagate it to the target service. Using this annotation the source service acts as an OIDC client obtaining a new access token for itself which then uses to identifies itself to the target service. In esthesis' default Keycloak esthesis-realm, there is a user created especially for this purpose.</p></li></ul></section></section><div class="last-modified">Last modified: 15 October 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="caching.html" class="navigation-links__prev">Redis cache</a><a href="testing.html" class="navigation-links__next">Testing</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.js"></script></body></html>