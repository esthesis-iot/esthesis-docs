<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="soft" data-primary-color="#059999" data-link-color="#059999"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-02-13T13:30:01.489822754"><title>Fiware Orion gateway DFL | esthesis CORE - Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"creating-devices-in-orion","level":0,"title":"Creating devices in Orion","anchor":"#creating-devices-in-orion"},{"id":"customising-data-synchronisation","level":0,"title":"Customising data synchronisation","anchor":"#customising-data-synchronisation"},{"id":"authentication","level":0,"title":"Authentication","anchor":"#authentication"},{"id":"inputs","level":0,"title":"Inputs","anchor":"#inputs"},{"id":"outputs","level":0,"title":"Outputs","anchor":"#outputs"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="16x16" href="images/logo.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Fiware Orion gateway DFL | esthesis CORE - Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="esthesis CORE - Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/fiware-orion-gateway.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Fiware Orion gateway DFL | esthesis CORE - Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/fiware-orion-gateway.html#webpage",
    "url": "writerside-documentation/fiware-orion-gateway.html",
    "name": "Fiware Orion gateway DFL | esthesis CORE - Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "esthesis CORE - Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="fiware-orion-gateway" data-main-title="Fiware Orion gateway DFL" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Dataflows"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>esthesis CORE - Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="fiware-orion-gateway" id="fiware-orion-gateway.md">Fiware Orion gateway DFL</h1><p id="z4zzd4y_3">The Fiware Orion gateway DFL is responsible for updating the Fiware Orion Context Broker with incoming telemetry and metadata values. It obtains values from Kafka, after they have been passed all possible processing steps. Data is classified on categories, with each category having one or more measurements. The DFL can also create new devices in Orion, if they are not yet known. It also provides detailed customisation options on how devices and data are synchronised with Orion. The DFL supports authentication with Orion, and can be configured to use different authentication methods.</p><section class="chapter"><h2 id="creating-devices-in-orion" data-toc="creating-devices-in-orion">Creating devices in Orion</h2><p id="z4zzd4y_9">To be able to push devices to Orion, the device should already be registered in Orion. The DFL can create the device in Orion automatically when configured so. Each device is registered with a name after its hardware ID, however you can set up a device attribute to act as the Orion device name. Similarly, a default device type named 'Device' is used, and that can also be customised in the settings of the DFL.</p><p id="z4zzd4y_10">You can have the DFL automatically trying to register in Orion all new devices in esthesis, or specify manually which devices should be registered using a boolean attribute set for devices.</p></section><section class="chapter"><h2 id="customising-data-synchronisation" data-toc="customising-data-synchronisation">Customising data synchronisation</h2><p id="z4zzd4y_11">By default, the DFL pushes data to Orion as <span class="control" id="z4zzd4y_16">NGSI-v2</span> valid entities. These entities are also designed to be compatible with the <span class="control" id="z4zzd4y_17">NGSI-LD</span> standard. Also, any new data available in Kafka will be immediately sent to Orion. However, the DFL provides several ways to customise how data is synchronised with Orion:</p><section class="chapter"><h3 id="1-specifying-attribute-names" data-toc="1-specifying-attribute-names">1. Specifying Attribute Names</h3><p id="z4zzd4y_18">You can define a list of attribute names to be synchronised. Any measurement not included in this list will be ignored and will not be sent to Orion.</p><p id="z4zzd4y_19">For example: If your esthesis device generates multiple measurements such as <code class="code" id="z4zzd4y_22">battery</code>, <code class="code" id="z4zzd4y_23">temperature</code>, <code class="code" id="z4zzd4y_24">co2</code>, <code class="code" id="z4zzd4y_25">memoryUsage</code>, etc., but you only want to synchronise the <code class="code" id="z4zzd4y_26">temperature</code> and <code class="code" id="z4zzd4y_27">co2</code> attributes, you can specify the attribute names in the configuration as follows: <code class="code" id="z4zzd4y_28">temperature,co2</code></p><p id="z4zzd4y_20">This ensures only the specified attributes are sent to Orion.</p></section><section class="chapter"><h3 id="2-configuring-time-intervals" data-toc="2-configuring-time-intervals">2. Configuring Time Intervals</h3><p id="z4zzd4y_29">The DFL allows you to configure a <span class="control" id="z4zzd4y_34">minimum time interval (in seconds)</span> for forwarding data from Kafka to Orion. This prevents data from being sent every time new data arrives and instead sends it periodically.</p><p id="z4zzd4y_30">For example: Setting the configuration value to <code class="code" id="z4zzd4y_35">900</code> (15 minutes) ensures that the same measurement will only be sent at least once every 15 minutes. Any values received for that measurement during the interval will not be sent to Orion until the interval elapses.</p><aside class="prompt" data-type="tip" data-title="" id="z4zzd4y_31"><p id="z4zzd4y_36"><span class="control" id="z4zzd4y_37">Important</span>: To ensure this configuration works reliably, make sure there is only one Kafka message consumer configured for this DFL instance. Multiple consumers could disrupt the interval-based forwarding logic.</p></aside><aside class="prompt" data-type="tip" data-title="" id="z4zzd4y_32"><p id="z4zzd4y_38"><span class="control" id="z4zzd4y_39">Important&sup2;</span>: This interval rule will not be triggered by past data of a measurement that has already been sent in real time. In other words, for historical data ingestion, any required interval should be prepared beforehand.</p></aside></section><section class="chapter"><h3 id="3-creating-custom-json" data-toc="3-creating-custom-json">3. Creating Custom JSON</h3><p id="z4zzd4y_40">If the default NGSI-v2 structure does not meet your requirements, you can define a fully customized JSON payload to be sent to Orion. This can be configured globally or per device.</p><section class="chapter"><h4 id="option-1-global-custom-json-format-applies-to-all-measurements" data-toc="option-1-global-custom-json-format-applies-to-all-measurements">Option 1: Global Custom JSON Format (Applies to All Measurements)</h4><ol class="list _decimal" id="z4zzd4y_44" type="1"><li class="list__item" id="z4zzd4y_46"><p>Define a global JSON format using the custom entity JSON configuration input.</p></li><li class="list__item" id="z4zzd4y_47"><p>Set its value as a valid <a href="https://quarkus.io/guides/qute" id="z4zzd4y_49" data-external="true" rel="noopener noreferrer">Qute template</a> expression that outputs a valid Orion Fiware JSON.</p></li><li class="list__item" id="z4zzd4y_48"><p>Use the following variables in the template: </p><ul class="list _bullet" id="z4zzd4y_50"><li class="list__item" id="z4zzd4y_51"><p><code class="code" id="z4zzd4y_56">{category}</code></p></li><li class="list__item" id="z4zzd4y_52"><p><code class="code" id="z4zzd4y_57">{timestamp}</code></p></li><li class="list__item" id="z4zzd4y_53"><p><code class="code" id="z4zzd4y_58">{hardwareId}</code></p></li><li class="list__item" id="z4zzd4y_54"><p><code class="code" id="z4zzd4y_59">{measurementName}</code></p></li><li class="list__item" id="z4zzd4y_55"><p><code class="code" id="z4zzd4y_60">{measurementValue}</code></p></li></ul></li></ol><p id="z4zzd4y_45">This approach ensures that all measurements from all esthesis agents follow the same JSON structure.</p></section><section class="chapter"><h4 id="option-2-per-device-custom-json-format-overrides-global-format" data-toc="option-2-per-device-custom-json-format-overrides-global-format">Option 2: Per-Device Custom JSON Format (Overrides Global Format)</h4><ol class="list _decimal" id="z4zzd4y_61" type="1"><li class="list__item" id="z4zzd4y_64"><p>Create an attribute in your esthesis device, e.g., <code class="code" id="z4zzd4y_69">orion-custom-json</code>.</p></li><li class="list__item" id="z4zzd4y_65"><p>Set the attribute value as a valid <a href="https://quarkus.io/guides/qute" id="z4zzd4y_70" data-external="true" rel="noopener noreferrer">Qute template</a> expression that outputs a valid Orion Fiware JSON.</p></li><li class="list__item" id="z4zzd4y_66"><p>Use the following variables in the template: </p><ul class="list _bullet" id="z4zzd4y_71"><li class="list__item" id="z4zzd4y_72"><p><code class="code" id="z4zzd4y_77">{category}</code></p></li><li class="list__item" id="z4zzd4y_73"><p><code class="code" id="z4zzd4y_78">{timestamp}</code></p></li><li class="list__item" id="z4zzd4y_74"><p><code class="code" id="z4zzd4y_79">{hardwareId}</code></p></li><li class="list__item" id="z4zzd4y_75"><p><code class="code" id="z4zzd4y_80">{measurementName}</code></p></li><li class="list__item" id="z4zzd4y_76"><p><code class="code" id="z4zzd4y_81">{measurementValue}</code></p></li></ul></li><li class="list__item" id="z4zzd4y_67"><p>Put your created attribute name in the custom entity JSON configuration, e.g., <code class="code" id="z4zzd4y_82">orion-custom-json</code>.</p></li><li class="list__item" id="z4zzd4y_68"><p>If this attribute is defined, it takes precedence over the global JSON format.</p></li></ol><p id="z4zzd4y_62">This setup allows for flexibility:</p><ul class="list _bullet" id="z4zzd4y_63"><li class="list__item" id="z4zzd4y_83"><p>If a device-specific template is set, it will be used for that given device.</p></li><li class="list__item" id="z4zzd4y_84"><p>If not, the global template will be used.</p></li></ul></section><section class="chapter"><h4 id="example-of-qute-template-expression-for-a-custom-json-format" data-toc="example-of-qute-template-expression-for-a-custom-json-format">Example of Qute Template expression for a custom JSON Format:</h4><div class="code-block" data-lang="json">
[
  {
    &quot;id&quot;: &quot;{measurementName}&quot;,
    &quot;type&quot;: &quot;{category}-custom-type&quot;,
    &quot;temperature&quot;: {
      &quot;type&quot;: &quot;Property&quot;,
      &quot;value&quot;: &quot;{measurementValue}&quot;,
      &quot;unitCode&quot;: &quot;CEL&quot;,
      &quot;observedAt&quot;: &quot;{timestamp}&quot;
    }
  }
]
</div></section></section></section><section class="chapter"><h2 id="authentication" data-toc="authentication">Authentication</h2><p id="z4zzd4y_86">Currently, two authentication methods are supported:</p><ol class="list _decimal" id="z4zzd4y_87" type="1"><li class="list__item" id="z4zzd4y_88"><p id="z4zzd4y_90"><span class="control" id="z4zzd4y_91">No Authentication</span> To access to Orion instance that doesn't require authentication.</p></li><li class="list__item" id="z4zzd4y_89"><p id="z4zzd4y_92"><span class="control" id="z4zzd4y_94">Keyrock OAuth2 Authentication</span> When using Keyrock for authentication, the following information must be configured:</p><ul class="list _bullet" id="z4zzd4y_93"><li class="list__item" id="z4zzd4y_95"><p id="z4zzd4y_100"><span class="control" id="z4zzd4y_101">Authentication URL</span>: The URL of the Keyrock Identity Provider to be used for authentication.</p></li><li class="list__item" id="z4zzd4y_96"><p id="z4zzd4y_102"><span class="control" id="z4zzd4y_103">Credential Token</span>: The token to be used for authenticating requests. This is typically obtained from the Keyrock platform.</p></li><li class="list__item" id="z4zzd4y_97"><p id="z4zzd4y_104"><span class="control" id="z4zzd4y_105">Username</span>: The username of the account that has access to the target Orion service.</p></li><li class="list__item" id="z4zzd4y_98"><p id="z4zzd4y_106"><span class="control" id="z4zzd4y_107">Password</span>: The password for the specified username.</p></li><li class="list__item" id="z4zzd4y_99"><p id="z4zzd4y_108"><span class="control" id="z4zzd4y_109">Grant Type</span>: The OAuth2 grant type to be used for authentication, e,g., <code class="code" id="z4zzd4y_110">password</code></p></li></ul></li></ol></section><section class="chapter"><h2 id="inputs" data-toc="inputs">Inputs</h2><ul class="list _bullet" id="z4zzd4y_111"><li class="list__item" id="z4zzd4y_112"><p>Gateway configuration: The DFL requires the connection details to the Fiware Orion Context Broker, including the URL, the service, the service path, and the service port. You can also specify the authentication method and credentials, as well as customising which devices get registered in Orion, how data is pushed, etc.</p></li><li class="list__item" id="z4zzd4y_113"><p>Redis: The DFL requires the connection details to the Redis cache.</p></li><li class="list__item" id="z4zzd4y_114"><p>Kafka: The DFL obtains telemetry and metadata from Kafka. It requires Kafka connection details, as well as the topic names from which to read metadata and telemetry. You may leave empty either of those, if you do not need to process telemetry or metadata respectively.</p></li><li class="list__item" id="z4zzd4y_115"><p>Kubernetes: The DFL is deployed as a Kubernetes deployment and requires the Kubernetes connection details.</p></li><li class="list__item" id="z4zzd4y_116"><p>Concurrency: You can set the number of messages the DFL can locally queue for processing, the polling frequency, as well as the number of parallel execution processing threads.</p></li><li class="list__item" id="z4zzd4y_117"><p>Logging: You can specify the logging level for the esthesis components in this DFL, as well as the general logging level.</p></li></ul></section><section class="chapter"><h2 id="outputs" data-toc="outputs">Outputs</h2><p id="z4zzd4y_118">The DFL updates a Fiware Orion Context Broker with incoming telemetry and metadata values.</p></section><div class="last-modified">Last modified: 13 February 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="redis-cache.html" class="navigation-links__prev">Redis cache DFL</a><a href="dev-environment-setup.html" class="navigation-links__next">Dev environment setup</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.js"></script></body></html>